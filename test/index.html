<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>vts-browser-js — manual tests</title>
    <style>
      :root {
        --fg: #111;
        --muted: #666;
        --rule: #e5e7eb;
        --link: #1a73e8;
        --bg: #fff;
      }
      html, body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--fg);
        font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      .wrap {
        max-width: 980px;
        margin: 32px auto 64px;
        padding: 0 16px;
      }
      h1 {
        font-size: 20px;
        font-weight: 600;
        margin: 0 0 16px;
      }
      p.note {
        color: var(--muted);
        margin: 0 0 24px;
      }
      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
      }
      thead th {
        text-align: left;
        font-weight: 600;
        padding: 10px 8px;
        border-bottom: 1px solid var(--rule);
        background: #fafafa;
      }
      tbody td {
        padding: 10px 8px;
        border-bottom: 1px solid var(--rule);
        vertical-align: top;
      }
      tbody tr:last-child td {
        border-bottom: 0;
      }
      a {
        color: var(--link);
        text-decoration: none;
      }
      a:hover { text-decoration: underline; }
      .idcell { white-space: nowrap; }
      .error {
        color: #b00020;
        background: #fff2f2;
        border: 1px solid #ffd6d6;
        padding: 10px 12px;
        border-radius: 6px;
        margin: 12px 0;
      }
      pre {
        background: #f6f8fa;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>vts-browser-js — manual tests</h1>
      <p class="note">Preconfigured map configs for quick visual regression checks.</p>
      <div id="errors"></div>
      <table aria-describedby="title">
        <thead>
          <tr>
            <th style="width:24%">ID</th>
            <th style="width:18%">Development</th>
            <th style="width:18%">Production</th>
            <th>Comment</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <p class="note">Automatic regression tests may be run as one of these commands</p>
      <pre><code>
      $ npm run test:perf
      $ npm run test:perf:headed
      </code></pre>
      <p class="note">If any these test have been run at least once, the latest result is available
      <a href="/test/perf/results/latest/summary.html">here</a>.</p>
    </div>

    <script>
      (function () {
        const $tbody = document.getElementById('tbody');
        const $errors = document.getElementById('errors');

        function showError(msg) {
          const el = document.createElement('div');
          el.className = 'error';
          el.textContent = msg;
          $errors.appendChild(el);
        }

        function expandTemplate(template, item) {
            return template.replace(/\$\{(\w+)\}/g, (_, key) => {
              return item[key] != null ? String(item[key]) : '';
            });
        }

        function mkLink(href, text) {
          const a = document.createElement('a');
          // remove accidental double slashes
          a.href = href.replace(/([^:]\/)\/+/g, '$1');
          a.textContent = text;
          a.target = '_blank';
          a.rel = 'noopener';
          return a;
        }

        function addRow(item, templates) {
          const tr = document.createElement('tr');

          const tdId = document.createElement('td');
          tdId.className = 'idcell';
          tdId.textContent = item.id;
          tr.appendChild(tdId);

          const tdDev = document.createElement('td');
          tdDev.appendChild(mkLink(expandTemplate(templates.dev, item), 'Development'));
          tr.appendChild(tdDev);

          const tdProd = document.createElement('td');
          tdProd.appendChild(mkLink(expandTemplate(templates.prod, item), 'Production'));
          tr.appendChild(tdProd);

          const tdDesc = document.createElement('td');
          tdDesc.textContent = item.description || '';
          tr.appendChild(tdDesc);

          $tbody.appendChild(tr);
        }

        fetch('./urls.json', { cache: 'no-cache' })
          .then(r => {
            if (!r.ok) throw new Error('Failed to load test/urls.json');
            return r.json();
          })
          .then(cfg => {
            if (!cfg || !cfg.templates || !cfg.urls) throw new Error('Invalid urls.json format');
            const templates = { dev: cfg.templates.dev, prod: cfg.templates.prod };
            cfg.urls.forEach(item => addRow(item, templates));
          })
          .catch(err => showError(err.message || String(err)));
      })();
    </script>
  </body>
</html>
