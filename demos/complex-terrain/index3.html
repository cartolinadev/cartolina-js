<!DOCTYPE html>
<html lang="en">
<head>
<title>Cartolina JS: A complex terrain with specular reflections and lettering</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="../../build/cartolina.js"></script>
<link href="../../build/cartolina.css" rel="stylesheet"/>
<style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>

function posFromURL() {


  const url = new URL(window.location.href); 
  const params = new URLSearchParams(url.search);
  if (!params) return null; 
  
  let pos = params.get('pos');
  if (!pos) return null;
  
  let pos_ = pos.split(',');
    
  for (let i = 1; i < pos_.length; i++) 
      if (i != 3) pos_[i] = parseFloat(pos_[i]);
      
  return pos_;
}


let position = ['obj', -118.302348, 36.560197, 'fix', 3313.32, -133.38, -25.09, 0.00, 33347.92, 45.00];

position = posFromURL() || position;


let map = cartolina.map({
    container: 'map',
    style: {
        version: 2,
        "reference-frame": "melown2015",
        sources: {
            "topoearth-copernicus-dem-glo30": {
                type: "cartolina-surface",
                url: "https://cdn.tspl.re/mapproxy/melown2015/surface/topoearth/copernicus-dem-glo30/",
            },
            "esa-worldcover2021": {
                type: "cartolina-tms",
                url: "https://cdn.tspl.re/mapproxy/melown2015/tms/topoearth/esa-worldcover2021-cr4/boundlayer.json"
            },
            "eoxit-s2c-normalmap": {
                type: "cartolina-tms",
                url: "https://cdn.tspl.re/mapproxy/melown2015/tms/topoearth/eoxit-s2c-2020-normalmap/boundlayer.json"
            },
            "esa-worldcover-specularmap": {
                type: "cartolina-tms",
                url: "https://cdn.tspl.re/mapproxy/melown2015/tms/topoearth/esa-worldcover-2021-specularmap/boundlayer.json"
            },
            "ne1lc-specularmap": {
                type: "cartolina-tms",
                url: "https://cdn.tspl.re/mapproxy/melown2015/tms/topoearth/ne1-lc-500m-specularmap/boundlayer.json"
            },
            "esa-worldcover-specularmap": {
                type: "cartolina-tms",
                url: "https://cdn.tspl.re/mapproxy/melown2015/tms/topoearth/esa-worldcover-2021-specularmap/boundlayer.json"
            },
            "osm-openfreemap": {
                type: "cartolina-freelayer",
                url: "https://cdn.tspl.re/mapproxy/melown2015/geodata/topoearth/osm-openfreemap/freelayer.json",
            }
        },
        terrain: {
            sources: ["topoearth-copernicus-dem-glo30"]
        },
        illumination: {
            "light": ["tracking", 315, 45],
            "ambientCoef": 0.0
        },
        "vertical-exaggeration" : {
            "heightRamp": [[0,4000], [1.5,1.3]],
            "viewExtentProgression": [12.3, 13e6, 1.38, 1, 13.5]
        },
        constants: {
            "@osmid": {"if":[["has","$id_"],"$id_",""]},
            "@name": {"if":[["has","$name"],{"if":[["any",["!has","$name:en"],["==",{"has-latin":"$name"},true]],"{$name}","{$name}\n{$name:en}"]},""]},
            "@serif-font": ["noto-mix","noto-cjk"],
            "@italic-font": ["noto-italic","noto-mix","noto-cjk"]
        },
        fonts: {
            "noto-italic": "https://cdn.tspl.re/fonts/noto-italic/1.0.0/noto-i.fnt",
            "noto-mix": "https://cdn.tspl.re/fonts/noto-extended/1.0.0/noto.fnt",
            "noto-cjk": "https://cdn.tspl.re/fonts/noto-cjk/1.0.0/noto.fnt",
            "noto-serif": "https://cdn.tspl.re/fonts/noto-serif/1.0.0/noto-serif.fnt"
        },
        layers: [
            /*{
                type: "diffuse-map",
                source: "esa-worldcover2021",
                necessity: "essential"
            }
            ,*/
            {
                type: "specular-map",
                source: "ne1lc-specularmap",
                necessity: "essential"
            }
            ,  
            {
                type: "specular-map",
                source: "esa-worldcover-specularmap",
                necessity: "essential",
            } 
        ]
    },
    position: position,
    options: { 
        positionInUrl: true, 
        mapSplitMeshes: false, 
    }
  });
</script>
</body>
</html>
